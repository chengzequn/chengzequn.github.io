<!-- 文章目录 -->
{% if page.layout == 'post' or page.layout == 'page' %}
  {% capture toc %}
    {% assign h2s = content | split: '<h2' %}
    {% if h2s.size > 1 or content contains '<h3' %}
      <section class="sidebar-section">
        <h3 class="sidebar-title">文章目录</h3>
        <div class="toc-content">
          <ul class="toc-list">
            {% assign in_h2 = false %}
            
            {% assign all_headings = content | split: '<h' %}
            {% for heading in all_headings %}
              {% if heading contains '2' or heading contains '3' %}
                {% assign heading_level = heading | slice: 0 %}
                {% assign heading_content = heading | replace_first: heading_level, '' | split: '</h' | first | split: '>' | last %}
                {% assign heading_id = heading_content | strip_html | downcase | replace: ' ', '-' | replace: '.', '' | replace: ',', '' | replace: '!', '' | replace: '?', '' | replace: ':', '' | replace: ';', '' | replace: '(', '' | replace: ')', '' %}
                
                {% if heading_level == '2' %}
                  {% if in_h2 %}
                    </ul>
                  </li>
                  {% endif %}
                  <li class="toc-h2">
                    <a href="#{{ heading_id }}" class="toc-link">
                      {{ heading_content | strip_html }}
                    </a>
                    <ul class="toc-h3-list">
                    {% assign in_h2 = true %}
                {% elsif heading_level == '3' %}
                  <li class="toc-h3">
                    <a href="#{{ heading_id }}" class="toc-link">
                      {{ heading_content | strip_html }}
                    </a>
                  </li>
                {% endif %}
              {% endif %}
            {% endfor %}
            
            {% if in_h2 %}
              </ul>
            </li>
            {% endif %}
          </ul>
        </div>
      </section>
    {% endif %}
  {% endcapture %}
  {{ toc }}
{% endif %}